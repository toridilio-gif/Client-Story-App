<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Story Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .container {
            max-width: 900px;
        }
        .form-input {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #d1d5db;
            transition: all 0.2s;
        }
        .form-input:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.3);
        }
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s;
        }
        .btn-primary {
            background-color: #4f46e5;
            color: #ffffff;
        }
        .btn-primary:hover {
            background-color: #4338ca;
        }
        .btn-secondary {
            background-color: #e5e7eb;
            color: #4b5563;
        }
        .btn-secondary:hover {
            background-color: #d1d5db;
        }
        .message-box {
            background-color: #ffffff;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .loading-container {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100px;
        }
        .loading-spinner {
            animation: spin 1s linear infinite;
            border: 4px solid #f3f4f6;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .prose li {
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <!-- Main Container -->
    <div class="container bg-white p-8 rounded-2xl shadow-xl space-y-8">
        <div class="text-center">
            <h1 class="text-3xl font-bold text-gray-800">Client Story Generator</h1>
            <p class="text-gray-500 mt-2">Fill out the details below to generate a client success story.</p>
        </div>

        <!-- Form Section -->
        <div class="space-y-6">
            <div>
                <label for="clientName" class="block text-sm font-medium text-gray-700 mb-1">Client Name</label>
                <input type="text" id="clientName" class="form-input" placeholder="e.g., Acme Corp">
            </div>
            <div>
                <label for="industry" class="block text-sm font-medium text-gray-700 mb-1">Industry</label>
                <input type="text" id="industry" class="form-input" placeholder="e.g., Tech Startup, Manufacturing">
            </div>
            <div>
                <label for="problem" class="block text-sm font-medium text-gray-700 mb-1">Problem they were facing</label>
                <textarea id="problem" rows="3" class="form-input" placeholder="e.g., They struggled with manual data entry which led to frequent errors and wasted time."></textarea>
            </div>
            <div>
                <label for="solution" class="block text-sm font-medium text-gray-700 mb-1">Our solution</label>
                <textarea id="solution" rows="3" class="form-input" placeholder="e.g., We implemented a new automated software that streamlined their workflow and integrated with existing systems."></textarea>
            </div>
            <div>
                <label for="results" class="block text-sm font-medium text-gray-700 mb-1">Key results/impact</label>
                <textarea id="results" rows="3" class="form-input" placeholder="e.g., Reduced data entry time by 50% and decreased errors by 90%."></textarea>
            </div>
        </div>

        <!-- Buttons -->
        <div class="flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-4">
            <button id="generateBtn" class="btn btn-primary w-full sm:w-auto">Generate Story</button>
        </div>
        
        <!-- Generated Content Section -->
        <div id="generatedContentSection" class="hidden space-y-6 mt-8">
            <hr class="border-gray-300">

            <!-- Primary Story Output -->
            <div>
                <h2 class="text-xl font-semibold text-gray-800 mb-2">Generated Story</h2>
                <div class="message-box max-h-96 overflow-y-auto">
                    <div id="storyOutput" class="prose max-w-none text-gray-700"></div>
                    <div id="storyLoading" class="loading-container" style="display: none;">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
            </div>

            <!-- New AI-powered Features -->
            <div class="flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-4">
                <button id="generateHeadlinesBtn" class="btn btn-secondary w-full sm:w-auto">✨ Generate Headlines</button>
                <button id="generateSocialBtn" class="btn btn-secondary w-full sm:w-auto">✨ Turn into Social Post</button>
            </div>

            <!-- Headlines Output -->
            <div id="headlinesSection" class="hidden">
                <h2 class="text-xl font-semibold text-gray-800 mb-2">Captivating Headlines</h2>
                <div class="message-box max-h-48 overflow-y-auto">
                    <div id="headlinesOutput" class="prose max-w-none text-gray-700"></div>
                    <div id="headlinesLoading" class="loading-container" style="display: none;">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
            </div>

            <!-- Social Post Output -->
            <div id="socialSection" class="hidden">
                <h2 class="text-xl font-semibold text-gray-800 mb-2">Social Media Post</h2>
                <div class="message-box max-h-48 overflow-y-auto">
                    <div id="socialOutput" class="prose max-w-none text-gray-700"></div>
                    <div id="socialLoading" class="loading-container" style="display: none;">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
            </div>
            
        </div>
        
        <!-- Error Box -->
        <div id="errorBox" class="text-red-500 text-sm mt-4 p-3 bg-red-50 rounded-lg hidden"></div>
    </div>

    <script>
        // Self-contained, runnable JS
        document.addEventListener('DOMContentLoaded', () => {
            const generateBtn = document.getElementById('generateBtn');
            const generateHeadlinesBtn = document.getElementById('generateHeadlinesBtn');
            const generateSocialBtn = document.getElementById('generateSocialBtn');
            
            const generatedContentSection = document.getElementById('generatedContentSection');
            const storyOutput = document.getElementById('storyOutput');
            const storyLoading = document.getElementById('storyLoading');
            
            const headlinesSection = document.getElementById('headlinesSection');
            const headlinesOutput = document.getElementById('headlinesOutput');
            const headlinesLoading = document.getElementById('headlinesLoading');
            
            const socialSection = document.getElementById('socialSection');
            const socialOutput = document.getElementById('socialOutput');
            const socialLoading = document.getElementById('socialLoading');
            
            const errorBox = document.getElementById('errorBox');
            
            // API configuration
            const apiKey = "";
            const apiUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent";

            // Exponential backoff for API retries
            const callApiWithBackoff = async (payload, retries = 3, delay = 1000) => {
                try {
                    const response = await fetch(`${apiUrl}?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 429 && retries > 0) {
                            console.warn(`Rate limited. Retrying in ${delay / 1000}s...`);
                            await new Promise(res => setTimeout(res, delay));
                            return callApiWithBackoff(payload, retries - 1, delay * 2);
                        }
                        throw new Error(`API request failed with status ${response.status}`);
                    }

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        return result.candidates[0].content.parts[0].text;
                    } else {
                        throw new Error("Invalid API response structure.");
                    }
                } catch (error) {
                    throw new Error(`Failed to get a response from the API: ${error.message}`);
                }
            };

            generateBtn.addEventListener('click', async () => {
                const clientName = document.getElementById('clientName').value;
                const industry = document.getElementById('industry').value;
                const problem = document.getElementById('problem').value;
                const solution = document.getElementById('solution').value;
                const results = document.getElementById('results').value;

                if (!clientName || !problem || !solution || !results) {
                    showError("Please fill in all the required fields.");
                    return;
                }

                // Hide secondary outputs and reset
                generatedContentSection.style.display = 'block';
                storyOutput.innerHTML = '';
                headlinesSection.style.display = 'none';
                socialSection.style.display = 'none';
                errorBox.style.display = 'none';
                storyLoading.style.display = 'flex';
                
                // Construct the prompt for the LLM
                const prompt = `
                    You are a professional business writer. Generate a short client success story in a positive and engaging tone. The story should be a single narrative paragraph and focus on the transformation from problem to solution to results.

                    Client Name: ${clientName}
                    Industry: ${industry || 'N/A'}
                    Problem: ${problem}
                    Our Solution: ${solution}
                    Results: ${results}

                    Start with the client's situation, introduce the problem, describe how our solution was implemented, and conclude with the tangible results and positive impact. The narrative should be no longer than 150 words.
                `;

                const payload = {
                    contents: [{
                        role: "user",
                        parts: [{ text: prompt }]
                    }]
                };

                try {
                    const generatedText = await callApiWithBackoff(payload);
                    storyOutput.innerHTML = `<p>${generatedText.trim()}</p>`;
                } catch (error) {
                    showError(`Failed to generate story: ${error.message}`);
                } finally {
                    storyLoading.style.display = 'none';
                }
            });

            generateHeadlinesBtn.addEventListener('click', async () => {
                const story = storyOutput.innerText;
                if (!story) {
                    showError("Please generate a story first.");
                    return;
                }
                
                headlinesSection.style.display = 'block';
                headlinesOutput.innerHTML = '';
                headlinesLoading.style.display = 'flex';
                errorBox.style.display = 'none';

                const prompt = `
                    Generate three captivating headlines for the following client success story. The headlines should be concise and attention-grabbing.
                    Story:
                    "${story}"
                `;
                
                const payload = {
                    contents: [{
                        role: "user",
                        parts: [{ text: prompt }]
                    }]
                };
                
                try {
                    const generatedText = await callApiWithBackoff(payload);
                    const headlinesList = generatedText.split('\n').filter(line => line.trim().length > 0);
                    let listHtml = '<ul>';
                    headlinesList.forEach(item => {
                        listHtml += `<li>${item.trim()}</li>`;
                    });
                    listHtml += '</ul>';
                    headlinesOutput.innerHTML = listHtml;
                } catch (error) {
                    showError(`Failed to generate headlines: ${error.message}`);
                } finally {
                    headlinesLoading.style.display = 'none';
                }
            });

            generateSocialBtn.addEventListener('click', async () => {
                const story = storyOutput.innerText;
                if (!story) {
                    showError("Please generate a story first.");
                    return;
                }
                
                socialSection.style.display = 'block';
                socialOutput.innerHTML = '';
                socialLoading.style.display = 'flex';
                errorBox.style.display = 'none';
                
                const prompt = `
                    Summarize the following client success story into a short, engaging social media post suitable for platforms like LinkedIn or X. Use a professional but positive tone. Include 2-3 relevant hashtags at the end. The post should be no more than 150 characters.
                    Story:
                    "${story}"
                `;

                const payload = {
                    contents: [{
                        role: "user",
                        parts: [{ text: prompt }]
                    }]
                };
                
                try {
                    const generatedText = await callApiWithBackoff(payload);
                    socialOutput.innerHTML = `<p>${generatedText.trim()}</p>`;
                } catch (error) {
                    showError(`Failed to generate social media post: ${error.message}`);
                } finally {
                    socialLoading.style.display = 'none';
                }
            });

            function showError(message) {
                errorBox.innerText = message;
                errorBox.style.display = 'block';
                generatedContentSection.style.display = 'none';
            }
        });
    </script>
</body>
</html>
